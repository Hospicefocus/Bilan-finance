<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üí∞ Syst√®me Financier Personnel</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, sans-serif; background: #f3f4f6; }
    .container { max-width: 1152px; margin: 0 auto; padding: 1rem; }
    .card { background: white; border-radius: 0.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); padding: 1.5rem; margin-bottom: 1rem; }
    .header { background: white; border-radius: 0.75rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); padding: 1.5rem; margin-bottom: 1rem; }
    .header h1 { font-size: 1.875rem; font-weight: bold; color: #1f2937; }
    .header p { color: #6b7280; margin-top: 0.25rem; }
    .tabs { background: white; border-radius: 0.75rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); padding: 0.5rem; margin-bottom: 1.5rem; display: flex; gap: 0.5rem; overflow-x: auto; }
    .tab { padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600; border: none; cursor: pointer; background: #f3f4f6; color: #374151; white-space: nowrap; }
    .tab.active { background: #3b82f6; color: white; }
    .tab.dashboard { background: #9333ea; }
    .tab.sop { background: #ea580c; }
    .tab.settings { background: #374151; }
    .banner { border-radius: 0.75rem; padding: 1.5rem; color: white; margin-bottom: 1rem; }
    .banner.blue { background: #3b82f6; }
    .banner.purple { background: #9333ea; }
    .banner.orange { background: #ea580c; }
    .banner.gray { background: #374151; }
    .banner h2 { font-size: 1.5rem; font-weight: bold; margin-bottom: 0.5rem; }
    .form-group { margin-bottom: 1rem; }
    .form-group label { display: block; font-weight: 600; margin-bottom: 0.5rem; color: #374151; }
    .form-input, .form-select { width: 100%; padding: 0.75rem 1rem; border: 2px solid #e5e7eb; border-radius: 0.5rem; font-size: 1rem; }
    .form-input:focus, .form-select:focus { outline: none; border-color: #3b82f6; }
    .grid { display: grid; gap: 1rem; }
    .grid-2 { grid-template-columns: 1fr; }
    @media (min-width: 768px) { .grid-2 { grid-template-columns: 1fr 1fr; } }
    .grid-3 { grid-template-columns: 1fr; }
    @media (min-width: 768px) { .grid-3 { grid-template-columns: repeat(3, 1fr); } }
    .grid-4 { grid-template-columns: repeat(2, 1fr); }
    @media (min-width: 768px) { .grid-4 { grid-template-columns: repeat(4, 1fr); } }
    .btn { width: 100%; padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: bold; border: none; cursor: pointer; font-size: 1rem; }
    .btn-primary { background: #3b82f6; color: white; }
    .btn-primary:hover { background: #2563eb; }
    .btn-danger { background: #dc2626; color: white; }
    .btn-danger:hover { background: #b91c1c; }
    .btn-small { padding: 0.5rem 1rem; width: auto; background: #f3f4f6; color: #374151; }
    .btn-small.active { background: #3b82f6; color: white; }
    .stat-card { background: white; border-radius: 0.75rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); padding: 1.5rem; }
    .stat-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; }
    .stat-value { font-size: 1.875rem; font-weight: bold; }
    .text-green { color: #16a34a; }
    .text-red { color: #dc2626; }
    .text-blue { color: #2563eb; }
    .text-gray { color: #6b7280; }
    .text-orange { color: #ea580c; }
    .transaction-item { display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: #f9fafb; border-radius: 0.5rem; margin-bottom: 0.5rem; border-left: 4px solid #e5e7eb; }
    .transaction-left { flex: 1; }
    .transaction-date { font-weight: 600; margin-bottom: 0.25rem; }
    .transaction-detail { font-size: 0.875rem; color: #6b7280; }
    .transaction-category { display: inline-block; padding: 0.125rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; font-weight: 600; margin-top: 0.25rem; }
    .transaction-right { text-align: right; margin-right: 0.5rem; }
    .transaction-delete { background: none; border: none; color: #dc2626; font-size: 1.5rem; cursor: pointer; padding: 0 0.5rem; }
    .transaction-delete:hover { color: #991b1b; }
    .list-container { max-height: 384px; overflow-y: auto; }
    .empty-state { text-align: center; color: #9ca3af; padding: 2rem; }
    .sop-section { background: white; border-radius: 0.75rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); padding: 1.5rem; margin-bottom: 1rem; }
    .sop-title { font-size: 1.25rem; font-weight: bold; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; }
    .sop-content { padding-left: 1rem; border-left: 4px solid #3b82f6; }
    .sop-content p { margin-bottom: 0.5rem; }
    .info-box { padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem; }
    .info-box.green { background: #f0fdf4; }
    .info-box.blue { background: #eff6ff; }
    .info-box.red { background: #fef2f2; }
    .info-box.orange { background: #fff7ed; }
    .info-box p { font-weight: 600; margin-bottom: 0.5rem; }
    .info-box ul, .info-box ol { margin-left: 1.5rem; font-size: 0.875rem; }
    .info-box li { margin-bottom: 0.25rem; }
    .repartition-item { display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: #f9fafb; border-radius: 0.5rem; margin-bottom: 0.5rem; }
    .category-stat { display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #f9fafb; border-radius: 0.5rem; margin-bottom: 0.5rem; border-left: 4px solid; }
    .progress-bar { width: 100%; height: 8px; background: #e5e7eb; border-radius: 4px; overflow: hidden; margin-top: 0.5rem; }
    .progress-fill { height: 100%; background: #3b82f6; transition: width 0.3s; }
    .alert { padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem; font-weight: 600; }
    .alert.success { background: #d1fae5; color: #065f46; }
    .alert.warning { background: #fef3c7; color: #92400e; }
    .alert.danger { background: #fee2e2; color: #991b1b; }
    .badge { display: inline-block; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.875rem; font-weight: 600; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üí∞ Syst√®me Financier Personnel</h1>
      <p>Plan 40/10/10/20/10/10 ‚Ä¢ <span id="currencyDisplay">FCFA</span></p>
    </div>

    <div class="tabs">
      <button onclick="showPage('saisie')" id="btnSaisie" class="tab active">üìù Saisie</button>
      <button onclick="showPage('dashboard')" id="btnDashboard" class="tab">üìä Dashboard</button>
      <button onclick="showPage('sop')" id="btnSop" class="tab">üìã SOP</button>
      <button onclick="showPage('settings')" id="btnSettings" class="tab">‚öôÔ∏è Param√®tres</button>
    </div>

    <div id="pageSaisie">
      <div class="banner blue">
        <h2>Saisie Quotidienne</h2>
        <p>Enregistre tes transactions en 2 minutes</p>
      </div>

      <div class="card">
        <div class="form-group">
          <label>Date</label>
          <input type="date" id="dateInput" class="form-input">
        </div>

        <div class="grid grid-2">
          <div class="form-group">
            <label>üí∞ Entr√©e (<span class="currency">FCFA</span>)</label>
            <input type="number" id="entreeInput" placeholder="Montant re√ßu" class="form-input">
          </div>
          <div class="form-group">
            <label>üì¶ Source / Offre / Service</label>
            <input type="text" id="sourceInput" placeholder="D'o√π vient l'argent" class="form-input">
          </div>
        </div>

        <div class="grid grid-2">
          <div class="form-group">
            <label>üí∏ Sortie (<span class="currency">FCFA</span>)</label>
            <input type="number" id="sortieInput" placeholder="Montant d√©pens√©" class="form-input">
          </div>
          <div class="form-group">
            <label>üè∑Ô∏è Cat√©gorie de d√©pense</label>
            <select id="categoryInput" class="form-select">
              <option value="">-- Choisir une cat√©gorie --</option>
              <option value="education">üìö √âducation</option>
              <option value="business">üíº Business</option>
              <option value="vie-courante">üè† Vie courante</option>
              <option value="transport">üöó Transport</option>
              <option value="personnel">üëï Personnel</option>
              <option value="investissement">üí∞ Investissement</option>
              <option value="dons">üéÅ Dons/Aides</option>
              <option value="abonnements">üì± Abonnements</option>
              <option value="voyage">‚úàÔ∏è Voyage</option>
              <option value="autre">‚ùì Autre</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label>üìù Motif / Description</label>
          <input type="text" id="motifInput" placeholder="Pourquoi cette transaction" class="form-input">
        </div>

        <button onclick="addTransaction()" class="btn btn-primary">‚úÖ Enregistrer</button>
      </div>

      <div class="card">
        <h3 style="font-size: 1.25rem; font-weight: bold; margin-bottom: 1rem;">Transactions r√©centes</h3>
        <div id="transactionsList" class="list-container"></div>
      </div>
    </div>

    <div id="pageDashboard" style="display: none;">
      <div class="banner purple">
        <h2>Dashboard Financier</h2>
        <p>Vue d'ensemble et analyses</p>
      </div>

      <div id="alertsContainer"></div>

      <div class="grid grid-3">
        <div class="stat-card">
          <div class="stat-header">
            <span class="text-gray">Total Entr√©es</span>
            <span style="font-size: 1.5rem;">üìà</span>
          </div>
          <div id="totalEntrees" class="stat-value text-green">0 FCFA</div>
          <div id="compareEntrees" style="font-size: 0.875rem; margin-top: 0.5rem; color: #6b7280;"></div>
        </div>

        <div class="stat-card">
          <div class="stat-header">
            <span class="text-gray">Total Sorties</span>
            <span style="font-size: 1.5rem;">üìâ</span>
          </div>
          <div id="totalSorties" class="stat-value text-red">0 FCFA</div>
          <div id="compareSorties" style="font-size: 0.875rem; margin-top: 0.5rem; color: #6b7280;"></div>
        </div>

        <div class="stat-card">
          <div class="stat-header">
            <span class="text-gray">Recette Nette</span>
            <span style="font-size: 1.5rem;">üí∞</span>
          </div>
          <div id="totalNet" class="stat-value text-blue">0 FCFA</div>
          <div id="compareNet" style="font-size: 0.875rem; margin-top: 0.5rem; color: #6b7280;"></div>
        </div>
      </div>

      <div class="card">
        <h3 style="font-size: 1.25rem; font-weight: bold; margin-bottom: 1rem;">üìä D√©penses par Cat√©gorie</h3>
        <div id="categoriesStats"></div>
      </div>

      <div class="card">
        <h3 style="font-size: 1.25rem; font-weight: bold; margin-bottom: 1rem;">üéØ R√©partition Automatique 40/10/10/20/10/10</h3>
        <div id="repartitionList"></div>
      </div>

      <div class="card">
        <h3 style="font-size: 1.25rem; font-weight: bold; margin-bottom: 1rem;">üèÜ Top 3 D√©penses du Mois</h3>
        <div id="top3Depenses"></div>
      </div>
    </div>

    <div id="pageSop" style="display: none;">
      <div class="banner orange">
        <h2>SOP - Routines Financi√®res</h2>
        <p>Proc√©dures guid√©es pour g√©rer tes finances</p>
      </div>

      <div class="sop-section">
        <h3 class="sop-title">üîÑ Routine Quotidienne (2 minutes)</h3>
        <div class="sop-content">
          <p><strong>1.</strong> Ouvrir l'onglet Saisie</p>
          <p><strong>2.</strong> Remplir Date, Entr√©e/Sortie, Cat√©gorie, Motif</p>
          <p><strong>3.</strong> Enregistrer la transaction</p>
          <p><strong>4.</strong> V√©rifier la recette journali√®re</p>
        </div>
      </div>

      <div class="sop-section">
        <h3 class="sop-title">üìÖ Revue Hebdomadaire (Dimanche - 10 min)</h3>
        <div class="info-box green">
          <p>‚úÖ V√©rifie dans le Dashboard :</p>
          <ul>
            <li>Total entr√©es et sorties de la semaine</li>
            <li>Recette nette (positif ou n√©gatif ?)</li>
            <li>Cat√©gorie qui co√ªte le plus</li>
            <li>Top 3 des d√©penses</li>
          </ul>
        </div>
        <div class="info-box blue">
          <p>‚ùì R√©ponds √† ces 5 questions :</p>
          <ol>
            <li>Qu'est-ce qui m'a co√ªt√© le plus cette semaine ?</li>
            <li>Est-ce que mes d√©penses correspondent √† mes priorit√©s ?</li>
            <li>Quelle entr√©e je peux multiplier √ó2 ?</li>
            <li>Quelle d√©pense inutile je peux √©liminer ?</li>
            <li>Que faire la semaine prochaine pour am√©liorer ?</li>
          </ol>
        </div>
        <div class="info-box orange">
          <p>üéØ Prends 1 micro-d√©cision :</p>
          <p style="font-weight: normal;">Augmenter les prix ? Lancer un service ? R√©duire une d√©pense ? Investir une petite somme ? Apprendre quelque chose ?</p>
        </div>
      </div>

      <div class="sop-section">
        <h3 class="sop-title">üìä Revue Mensuelle (1er du mois - 20 min)</h3>
        <div class="sop-content">
          <p>‚úì V√©rifier les cumuls mensuels</p>
          <p>‚úì Analyser les cat√©gories de d√©penses</p>
          <p>‚úì V√©rifier les r√©partitions 40/10/10/20/10/10</p>
          <p>‚úì Comparer avec le mois pr√©c√©dent</p>
          <p>‚úì Voir l'√©volution sur 3 mois</p>
        </div>
        <div class="info-box blue" style="margin-top: 1rem;">
          <p>üéØ D√©cider :</p>
          <ul style="font-weight: normal;">
            <li>Objectif financier du mois prochain</li>
            <li>Plan d'action business (une seule priorit√©)</li>
            <li>Zone o√π investir (√©ducation, business, crypto...)</li>
            <li>Budget par cat√©gorie</li>
          </ul>
        </div>
      </div>

      <div class="sop-section">
        <h3 class="sop-title">üöÄ Revue Trimestrielle (Chaque 90 jours)</h3>
        <div class="info-box red">
          <p>üîç Questions critiques :</p>
          <ol>
            <li>Est-ce que mes revenus ont augment√© sur 3 mois ?</li>
            <li>Quelle offre m'a rapport√© le plus ?</li>
            <li>Quelle cat√©gorie de d√©pense est devenue inutile ?</li>
            <li>Quel investissement a √©t√© le plus rentable ?</li>
            <li>Quelle opportunit√© ai-je rat√©e ?</li>
            <li>Mes d√©penses suivent-elles mes objectifs de vie ?</li>
          </ol>
        </div>
        <div class="info-box orange" style="margin-top: 1rem;">
          <p>üí° D√©cisions strat√©giques √† prendre :</p>
          <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem; font-weight: normal;">
            <div>‚Ä¢ Am√©liorer une offre</div>
            <div>‚Ä¢ Arr√™ter une d√©pense</div>
            <div>‚Ä¢ Augmenter mes prix</div>
            <div>‚Ä¢ R√©investir davantage</div>
            <div>‚Ä¢ √âpargner plus</div>
            <div>‚Ä¢ Optimiser mon style de vie</div>
          </div>
        </div>
      </div>
    </div>

    <div id="pageSettings" style="display: none;">
      <div class="banner gray">
        <h2>Param√®tres</h2>
        <p>Configuration de l'application</p>
      </div>

      <div class="card">
        <h3 style="font-size: 1.25rem; font-weight: bold; margin-bottom: 1rem;">üí± Devise</h3>
        <div class="grid grid-4" id="currencyButtons"></div>
        <div style="margin-top: 1rem;">
          <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">Devise personnalis√©e :</label>
          <div style="display: flex; gap: 0.5rem;">
            <input type="text" id="customCurrency" placeholder="Ex: DZD, TND" class="form-input" style="flex: 1;">
            <button onclick="setCustomCurrency()" class="btn-small" style="background: #3b82f6; color: white;">Valider</button>
          </div>
        </div>
      </div>

      <div class="card">
        <h3 style="font-size: 1.25rem; font-weight: bold; margin-bottom: 1rem;">üìä Statistiques</h3>
        <div style="padding: 1rem; background: #f9fafb; border-radius: 0.5rem;">
          <p style="font-weight: 600; margin-bottom: 0.5rem;">Total transactions : <span id="transCount">0</span></p>
          <p style="font-weight: 600; margin-bottom: 0.5rem;">Depuis : <span id="firstDate">--</span></p>
          <p style="font-weight: 600;">Cat√©gorie pr√©f√©r√©e : <span id="favCategory">--</span></p>
        </div>
      </div>

      <div class="card">
        <h3 style="font-size: 1.25rem; font-weight: bold; margin-bottom: 1rem;">üíæ Gestion des donn√©es</h3>
        <button onclick="exportData()" class="btn-small" style="width: 100%; margin-bottom: 0.5rem; background: #10b981; color: white;">
          üì• T√©l√©charger mes donn√©es (CSV)
        </button>
        <button onclick="resetData()" class="btn btn-danger">
          üóëÔ∏è R√©initialiser toutes les donn√©es
        </button>
      </div>

      <div style="padding: 1rem; background: #eff6ff; border-radius: 0.5rem; border: 2px solid #3b82f6;">
        <p style="font-weight: 600; color: #1e40af; margin-bottom: 0.5rem;">üí° √Ä propos</p>
        <p style="font-size: 0.875rem; color: #1e3a8a;">Syst√®me Financier Personnel v2.0</p>
        <p style="font-size: 0.875rem; color: #1e3a8a;">Plan automatique 40/10/10/20/10/10</p>
        <p style="font-size: 0.875rem; color: #1e3a8a; margin-top: 0.5rem;">‚ú® Nouveau : Cat√©gories, analyses et alertes intelligentes</p>
      </div>
    </div>
  </div>

  <script>
    let currency = 'FCFA';
    let transactions = [];

    const categories = {
      'education': { name: 'üìö √âducation', color: '#f59e0b' },
      'business': { name: 'üíº Business', color: '#3b82f6' },
      'vie-courante': { name: 'üè† Vie courante', color: '#10b981' },
      'transport': { name: 'üöó Transport', color: '#ef4444' },
      'personnel': { name: 'üëï Personnel', color: '#8b5cf6' },
      'investissement': { name: 'üí∞ Investissement', color: '#14b8a6' },
      'dons': { name: 'üéÅ Dons/Aides', color: '#ec4899' },
      'abonnements': { name: 'üì± Abonnements', color: '#6366f1' },
      'voyage': { name: '‚úàÔ∏è Voyage', color: '#f97316' },
      'autre': { name: '‚ùì Autre', color: '#6b7280' }
    };

    function init() {
      const savedCurrency = localStorage.getItem('currency');
      if (savedCurrency) currency = savedCurrency;
      
      const savedTrans = localStorage.getItem('transactions');
      if (savedTrans) transactions = JSON.parse(savedTrans);
      
      document.getElementById('dateInput').value = new Date().toISOString().split('T')[0];
      
      updateCurrencyDisplay();
      renderTransactions();
      updateDashboard();
      renderCurrencyButtons();
    }

    function showPage(page) {
      document.getElementById('pageSaisie').style.display = 'none';
      document.getElementById('pageDashboard').style.display = 'none';
      document.getElementById('pageSop').style.display = 'none';
      document.getElementById('pageSettings').style.display = 'none';
      
      document.getElementById('btnSaisie').className = 'tab';
      document.getElementById('btnDashboard').className = 'tab';
      document.getElementById('btnSop').className = 'tab';
      document.getElementById('btnSettings').className = 'tab';
      
      if (page === 'saisie') {
        document.getElementById('pageSaisie').style.display = 'block';
        document.getElementById('btnSaisie').className = 'tab active';
      } else if (page === 'dashboard') {
        document.getElementById('pageDashboard').style.display = 'block';
        document.getElementById('btnDashboard').className = 'tab active dashboard';
        updateDashboard();
      } else if (page === 'sop') {
        document.getElementById('pageSop').style.display = 'block';
        document.getElementById('btnSop').className = 'tab active sop';
      } else if (page === 'settings') {
        document.getElementById('pageSettings').style.display = 'block';
        document.getElementById('btnSettings').className = 'tab active settings';
        updateSettings();
      }
    }

    function addTransaction() {
      const entree = parseFloat(document.getElementById('entreeInput').value) || 0;
      const sortie = parseFloat(document.getElementById('sortieInput').value) || 0;
      const source = document.getElementById('sourceInput').value;
      const motif = document.getElementById('motifInput').value;
      const category = document.getElementById('categoryInput').value;
      const date = document.getElementById('dateInput').value;
      const recette = entree - sortie;

      const trans = {
        id: Date.now(),
        date: date,
        entree: entree,
        source: source,
        sortie: sortie,
        motif: motif,
        category: category,
        recette: recette
      };

      transactions.unshift(trans);
      localStorage.setItem('transactions', JSON.stringify(transactions));

      document.getElementById('entreeInput').value = '';
      document.getElementById('sourceInput').value = '';
      document.getElementById('sortieInput').value = '';
      document.getElementById('motifInput').value = '';
      document.getElementById('categoryInput').value = '';
      document.getElementById('dateInput').value = new Date().toISOString().split('T')[0];

      renderTransactions();
    }

    function deleteTransaction(id) {
      if (confirm('Supprimer cette transaction ?')) {
        transactions = transactions.filter(t => t.id !== id);
        localStorage.setItem('transactions', JSON.stringify(transactions));
        renderTransactions();
      }
    }

    function renderTransactions() {
      const list = document.getElementById('transactionsList');
      if (transactions.length === 0) {
        list.innerHTML = '<div class="empty-state">Aucune transaction enregistr√©e</div>';
        return;
      }

      list.innerHTML = transactions.slice(0, 10).map(t => {
        const catInfo = categories[t.category] || { name: '', color: '#e5e7eb' };
        return `
        <div class="transaction-item" style="border-left-color: ${catInfo.color}">
          <div class="transaction-left">
            <div class="transaction-date">${new Date(t.date).toLocaleDateString('fr-FR')} ${t.recette < 0 ? '‚ö†Ô∏è' : ''}</div>
            <div class="transaction-detail">${t.source} ${t.motif}</div>
            ${t.category ? `<span class="transaction-category" style="background: ${catInfo.color}22; color: ${catInfo.color}">${catInfo.name}</span>` : ''}
          </div>
          <div class="transaction-right">
            ${t.entree > 0 ? `<div style="color: #16a34a; font-weight: bold;">+${t.entree.toLocaleString()}</div>` : ''}
            ${t.sortie > 0 ? `<div style="color: #dc2626; font-weight: bold;">-${t.sortie.toLocaleString()}</div>` : ''}
            <div style="font-weight: 600; color: ${t.recette >= 0 ? '#2563eb' : '#dc2626'}">${t.recette.toLocaleString()} ${currency}</div>
          </div>
          <button onclick="deleteTransaction(${t.id})" class="transaction-delete">√ó</button>
        </div>
      `}).join('');
    }

    function updateDashboard() {
      const now = new Date();
      const thisMonth = transactions.filter(t => {
        const td = new Date(t.date);
        return td.getMonth() === now.getMonth() && td.getFullYear() === now.getFullYear();
      });

      const lastMonth = transactions.filter(t => {
        const td = new Date(t.date);
        const lm = new Date(now.getFullYear(), now.getMonth() - 1);
        return td.getMonth() === lm.getMonth() && td.getFullYear() === lm.getFullYear();
      });

      const totalE = thisMonth.reduce((sum, t) => sum + t.entree, 0);
      const totalS = thisMonth.reduce((sum, t) => sum + t.sortie, 0);
      const net = totalE - totalS;

      const lastE = lastMonth.reduce((sum, t) => sum + t.entree, 0);
      const lastS = lastMonth.reduce((sum, t) => sum + t.sortie, 0);
      const lastNet = lastE - lastS;

      document.getElementById('totalEntrees').textContent = `${totalE.toLocaleString()} ${currency}`;
      document.getElementById('totalSorties').textContent = `${totalS.toLocaleString()} ${currency}`;
      document.getElementById('totalNet').textContent = `${net.toLocaleString()} ${currency}`;
      document.getElementById('totalNet').className = `stat-value ${net >= 0 ? 'text-blue' : 'text-red'}`;

      // Comparaison avec mois pr√©c√©dent
      if (lastE > 0) {
        const diffE = totalE - lastE;
        const percE = ((diffE / lastE) * 100).toFixed(1);
        document.getElementById('compareEntrees').innerHTML = diffE >= 0 
          ? `<span style="color: #16a34a;">‚Üó +${percE}% vs mois dernier</span>`
          : `<span style="color: #dc2626;">‚Üò ${percE}% vs mois dernier</span>`;
      }

      if (lastS > 0) {
        const diffS = totalS - lastS;
        const percS = ((diffS / lastS) * 100).toFixed(1);
        document.getElementById('compareSorties').innerHTML = diffS >= 0 
          ? `<span style="color: #dc2626;">‚Üó +${percS}% vs mois dernier</span>`
          : `<span style="color: #16a34a;">‚Üò ${percS}% vs mois dernier</span>`;
      }

      if (lastNet !== 0) {
        const diffNet = net - lastNet;
        const percNet = ((diffNet / Math.abs(lastNet)) * 100).toFixed(1);
        document.getElementById('compareNet').innerHTML = diffNet >= 0 
          ? `<span style="color: #16a34a;">‚Üó +${percNet}% vs mois dernier</span>`
          : `<span style="color: #dc2626;">‚Üò ${percNet}% vs mois dernier</span>`;
      }

      // Alertes intelligentes
      renderAlerts(totalE, totalS, net);

      // Statistiques par cat√©gorie
      renderCategoryStats(thisMonth, totalS);

      // R√©partition
      const repartition = [
        { name: 'Compte Courant (40%)', value: net * 0.4 },
        { name: 'Investissement (10%)', value: net * 0.1 },
        { name: '√âpargne LT (10%)', value: net * 0.1 },
        { name: '√âducation (20%)', value: net * 0.2 },
        { name: 'Dons (10%)', value: net * 0.1 },
        { name: 'Libre (10%)', value: net * 0.1 }
      ];

      document.getElementById('repartitionList').innerHTML = repartition.map(r => `
        <div class="repartition-item">
          <span style="font-weight: 600;">${r.name}</span>
          <span style="font-weight: bold;">${r.value.toLocaleString()} ${currency}</span>
        </div>
      `).join('');

      // Top 3 d√©penses
      renderTop3(thisMonth);
    }

    function renderAlerts(totalE, totalS, net) {
      const alerts = document.getElementById('alertsContainer');
      let html = '';

      if (net < 0) {
        html += '<div class="alert danger">‚ö†Ô∏è Attention ! Tes d√©penses d√©passent tes revenus ce mois-ci</div>';
      } else if (net > 0 && totalE > 0) {
        const ratio = (net / totalE) * 100;
        if (ratio >= 30) {
          html += '<div class="alert success">üî• Excellent ! Tu √©pargnes ' + ratio.toFixed(0) + '% de tes revenus !</div>';
        }
      }

      if (totalS > totalE * 0.8 && totalE > 0) {
        html += '<div class="alert warning">‚ö° Tu as d√©pens√© 80% de tes revenus ce mois</div>';
      }

      alerts.innerHTML = html;
    }

    function renderCategoryStats(monthData, totalSorties) {
      const catStats = {};
      
      monthData.forEach(t => {
        if (t.sortie > 0 && t.category) {
          if (!catStats[t.category]) {
            catStats[t.category] = { total: 0, count: 0 };
          }
          catStats[t.category].total += t.sortie;
          catStats[t.category].count++;
        }
      });

      const sorted = Object.entries(catStats)
        .map(([cat, data]) => ({
          category: cat,
          total: data.total,
          count: data.count,
          percent: totalSorties > 0 ? (data.total / totalSorties * 100) : 0
        }))
        .sort((a, b) => b.total - a.total);

      const container = document.getElementById('categoriesStats');
      
      if (sorted.length === 0) {
        container.innerHTML = '<div class="empty-state">Aucune d√©pense cat√©goris√©e ce mois</div>';
        return;
      }

      container.innerHTML = sorted.map(item => {
        const catInfo = categories[item.category] || { name: item.category, color: '#6b7280' };
        return `
          <div class="category-stat" style="border-left-color: ${catInfo.color}">
            <div style="flex: 1;">
              <div style="font-weight: 600; margin-bottom: 0.25rem;">${catInfo.name}</div>
              <div style="font-size: 0.875rem; color: #6b7280;">${item.count} transaction(s) ‚Ä¢ ${item.percent.toFixed(1)}% du total</div>
              <div class="progress-bar">
                <div class="progress-fill" style="width: ${item.percent}%; background: ${catInfo.color}"></div>
              </div>
            </div>
            <div style="font-size: 1.25rem; font-weight: bold; color: ${catInfo.color};">
              ${item.total.toLocaleString()} ${currency}
            </div>
          </div>
        `;
      }).join('');
    }

    function renderTop3(monthData) {
      const sorted = monthData
        .filter(t => t.sortie > 0)
        .sort((a, b) => b.sortie - a.sortie)
        .slice(0, 3);

      const container = document.getElementById('top3Depenses');
      
      if (sorted.length === 0) {
        container.innerHTML = '<div class="empty-state">Aucune d√©pense ce mois</div>';
        return;
      }

      const medals = ['ü•á', 'ü•à', 'ü•â'];
      
      container.innerHTML = sorted.map((t, i) => {
        const catInfo = t.category ? categories[t.category] : null;
        return `
          <div style="display: flex; align-items: center; padding: 1rem; background: #f9fafb; border-radius: 0.5rem; margin-bottom: 0.5rem;">
            <div style="font-size: 2rem; margin-right: 1rem;">${medals[i]}</div>
            <div style="flex: 1;">
              <div style="font-weight: 600;">${t.motif || t.source || 'Sans description'}</div>
              <div style="font-size: 0.875rem; color: #6b7280;">
                ${new Date(t.date).toLocaleDateString('fr-FR')}
                ${catInfo ? ` ‚Ä¢ ${catInfo.name}` : ''}
              </div>
            </div>
            <div style="font-size: 1.5rem; font-weight: bold; color: #dc2626;">
              ${t.sortie.toLocaleString()} ${currency}
            </div>
          </div>
        `;
      }).join('');
    }

    function updateCurrencyDisplay() {
      document.getElementById('currencyDisplay').textContent = currency;
      document.querySelectorAll('.currency').forEach(el => el.textContent = currency);
    }

    function setCurrency(curr) {
      currency = curr;
      localStorage.setItem('currency', curr);
      updateCurrencyDisplay();
      renderTransactions();
      updateDashboard();
      renderCurrencyButtons();
    }

    function setCustomCurrency() {
      const custom = document.getElementById('customCurrency').value.trim().toUpperCase();
      if (custom) {
        setCurrency(custom);
        document.getElementById('customCurrency').value = '';
      }
    }

    function renderCurrencyButtons() {
      const currencies = ['FCFA', 'EUR', 'USD', 'GBP', 'CAD', 'CHF', 'XOF', 'MAD'];
      document.getElementById('currencyButtons').innerHTML = currencies.map(c => `
        <button onclick="setCurrency('${c}')" class="btn-small ${currency === c ? 'active' : ''}">
          ${c}
        </button>
      `).join('');
    }

    function updateSettings() {
      document.getElementById('transCount').textContent = transactions.length;
      
      if (transactions.length > 0) {
        const dates = transactions.map(t => new Date(t.date)).sort((a, b) => a - b);
        document.getElementById('firstDate').textContent = dates[0].toLocaleDateString('fr-FR');
        
        const catCount = {};
        transactions.forEach(t => {
          if (t.category) {
            catCount[t.category] = (catCount[t.category] || 0) + 1;
          }
        });
        
        const favCat = Object.entries(catCount).sort((a, b) => b[1] - a[1])[0];
        if (favCat) {
          const catInfo = categories[favCat[0]];
          document.getElementById('favCategory').textContent = catInfo.name;
        }
      }
    }

    function exportData() {
      if (transactions.length === 0) {
        alert('Aucune donn√©e √† exporter');
        return;
      }

      let csv = 'Date,Entr√©e,Source,Sortie,Cat√©gorie,Motif,Recette\n';
      
      transactions.forEach(t => {
        const catInfo = t.category ? categories[t.category].name : '';
        csv += `${t.date},${t.entree},"${t.source}",${t.sortie},"${catInfo}","${t.motif}",${t.recette}\n`;
      });

      const blob = new Blob([csv], { type: 'text/csv' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `finances_${new Date().toISOString().split('T')[0]}.csv`;
      a.click();
      window.URL.revokeObjectURL(url);
    }

    function resetData() {
      if (confirm('‚ö†Ô∏è ATTENTION ! Supprimer toutes les donn√©es ? Cette action est irr√©versible !')) {
        if (confirm('Es-tu vraiment s√ªr ? Toutes tes transactions seront perdues !')) {
          transactions = [];
          localStorage.setItem('transactions', JSON.stringify(transactions));
          renderTransactions();
          updateDashboard();
          updateSettings();
          alert('‚úÖ Toutes les donn√©es ont √©t√© supprim√©es');
        }
      }
    }

    window.onload = init;
  </script>
</body>
</html>
